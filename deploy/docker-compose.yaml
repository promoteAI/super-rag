services:
  seekdb:
    image: oceanbase/seekdb:latest
    container_name: seekdb
    restart: always
    environment:
      - ROOT_PASSWORD=${ROOT_PASSWORD:-123456}
      - SEEKDB_DATABASE=${SEEKDB_DATABASE:-super_rag}
    ports:
      - "2881:2881"
      - "2886:2886"
    volumes:
      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/seekdb:/var/lib/oceanbase

  rustfs:
    container_name: rustfs
    image: rustfs/rustfs:1.0.0-alpha.58
    environment:
      - RUSTFS_VOLUMES=/data/rustfs0,/data/rustfs1,/data/rustfs2,/data/rustfs3
      - RUSTFS_ADDRESS=0.0.0.0:9000
      - RUSTFS_CONSOLE_ADDRESS=0.0.0.0:9001
      - RUSTFS_CONSOLE_ENABLE=true
      - RUSTFS_EXTERNAL_ADDRESS=:9000  # Same as internal since no port mapping
      - RUSTFS_CORS_ALLOWED_ORIGINS=*
      - RUSTFS_CONSOLE_CORS_ALLOWED_ORIGINS=*
      - RUSTFS_ACCESS_KEY=minioadmin
      - RUSTFS_SECRET_KEY=minioadmin
    ports:
      - "9000:9000" # S3 API port
      - "9001:9001" # Console port
    volumes:
      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/rustfs_data_0:/data/rustfs0
      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/rustfs_data_1:/data/rustfs1
      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/rustfs_data_2:/data/rustfs2
      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/rustfs_data_3:/data/rustfs3
      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/logs_data:/app/logs
    restart: unless-stopped
    healthcheck:
      test:
        [
          "CMD",
          "sh", "-c",
          "curl -f http://localhost:9000/health && curl -f http://localhost:9001/health"
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  default:
    name: super_rag
